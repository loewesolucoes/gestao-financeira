"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3469],{3469:(e,a,t)=>{t.d(a,{X:()=>S});var l=t(5155),n=t(130),s=t(2940),r=t.n(s),i=t(5695),o=t(402),c=t(8266),d=t(2115),u=t(5143),m=t(690),x=t(4241),f=t(8555),h=t(8870),p=t(4208),j=t(8310),g=t(5893),v=t(5550),N=t(3748);let b=new Date;function S(e){let{isCopy:a,tableName:t}=e,s=t||p.tw.TRANSACOES,{params:o}=(0,v.z)(),c=o.get("month"),u=r()(c,"YYYY-MM"),h=(0,i.useRouter)(),{isDbOk:j,repository:S}=(0,N.r)(),[C,w]=(0,d.useState)(!0),[I,_]=(0,d.useState)(b),[T,D]=(0,d.useState)([]),[A,E]=(0,d.useState)([]),[O,Y]=(0,d.useState)(!1),[k,F]=(0,d.useState)(),[R,V]=(0,d.useState)([]),[B,P]=(0,d.useState)([]),[z,G]=(0,d.useState)([]),[X,q]=(0,d.useState)(new n.A(0)),K=s===p.tw.PATRIMONIO;async function L(){let e;w(!0),e=s===p.tw.PATRIMONIO?await S.patrimonio.listByMonth(u.format("MM"),u.format("YYYY")):await S.transacoes.listByMonth(u.format("MM"),u.format("YYYY")),a&&e.forEach(e=>{delete e.id,delete e.createdDate,delete e.updatedDate,e.data=b}),D(e),w(!1)}async function Z(){if(!confirm("Voc\xea tem certeza?"))return;w(!0);let e=H();a&&e.forEach(e=>{e.data=e.data===b?I:e.data}),e.forEach((e,a)=>{e.ordem=a,delete e.__dndId}),K&&e.forEach(e=>{delete e.categoriaId,delete e.tipo}),await Promise.all(A.filter(e=>e.id).map(e=>S.delete(s,e.id))),await S.saveAll(s,e),w(!1),console.log("transacoesOk",e),h.push(K?"/patrimonio":"/caixa")}function H(){return[...R,...B,...z]}function J(e){let a=H(),t=a.indexOf(e),l=[...a];l.splice(t,1),D(l),E(a=>[...a,e])}return(0,d.useEffect)(()=>{j&&L()},[j]),(0,d.useEffect)(()=>{if(Array.isArray(T)){let e=T.map((e,a)=>{var t;return{...e,__dndId:"".concat(e.id,":").concat(a,":").concat(e.local,":").concat(null==(t=e.createdDate)?void 0:t.toISOString())}}),a=e.filter(e=>{var a;return null==e||null==(a=e.valor)?void 0:a.isGreaterThan(0)}),t=e.filter(e=>{var a;return null==e||null==(a=e.valor)?void 0:a.isLessThanOrEqualTo(0)}),l=e.filter(e=>{var a,t;return(null==e?void 0:e.valor)==null||(null==e||null==(a=e.valor)?void 0:a.isNaN())||(null==e||null==(t=e.valor)?void 0:t.isZero())}),s=e.filter(e=>null==e?void 0:e.valor).reduce((e,a)=>a.valor.plus(e),(0,n.A)(0));V(a),P(t),G(l),q(s)}},[T]),(0,l.jsxs)(l.Fragment,{children:[C?(0,l.jsx)(x.a,{className:"align-self-center my-5"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center align-items-lg-end flex-column flex-lg-row gap-3",children:[(0,l.jsx)(M,{total:X}),(0,l.jsx)("div",{className:"d-flex gap-3 flex-column flex-lg-row",children:(0,l.jsx)("button",{type:"button",className:"btn btn-dark",onClick:()=>Y(!0),children:"Adicionar nova"})})]}),(0,l.jsx)(y,{tipo:"receitas",transacoes:R,onChange:V,tableName:s,removerTransacao:J,setEditTransacao:F}),(0,l.jsx)(y,{tipo:"despesas",transacoes:B,onChange:P,tableName:s,removerTransacao:J,setEditTransacao:F}),(0,l.jsx)(y,{tipo:"semValor",transacoes:z,onChange:G,tableName:s,removerTransacao:J,setEditTransacao:F}),(0,l.jsx)("div",{className:"d-flex justify-content-center justify-content-lg-end",children:(0,l.jsxs)("div",{className:"d-flex gap-3 flex-column flex-lg-row",children:[(0,l.jsx)(M,{total:X}),a&&(0,l.jsxs)("div",{className:"form-floating",children:[(0,l.jsx)(m.p,{type:"month",className:"form-control",id:"data",placeholder:"M\xeas a aplicar",value:I,onChange:e=>_(e)}),(0,l.jsx)("label",{htmlFor:"data",className:"form-label",children:"M\xeas a aplicar"})]}),(0,l.jsx)("button",{type:"button",className:"btn btn-primary",onClick:()=>Z(),children:a?"Copiar transa\xe7\xf5es para o m\xeas":"Salvar transa\xe7\xf5es do m\xeas"})]})})]}),O&&(0,l.jsx)(f.a,{hideFooter:!0,onClose:()=>Y(!1),title:"Adicionar transa\xe7\xe3o",children:(0,l.jsx)(g.p,{tableName:s,cleanStyle:!0,onClose:()=>Y(!1),onCustomSubmit:e=>(function(e){let a=[...H()];a.push(e),D(a)})(e),onCustomDelete:()=>Y(!1)})}),k&&(0,l.jsx)(f.a,{hideFooter:!0,onClose:()=>F(null),title:"Detalhes da transa\xe7\xe3o: ".concat(null==k?void 0:k.local),children:(0,l.jsx)(g.p,{tableName:s,transacao:k,cleanStyle:!0,onClose:()=>F(null),onCustomSubmit:e=>(function(e,a){let t=H(),l=t.indexOf(e),n=[...t];n[l]={...a},D(n)})(k,e),onCustomDelete:()=>J(k)})})]})}function y(e){let{transacoes:a,onChange:t,removerTransacao:n,tableName:s,setEditTransacao:r,tipo:i}=e,[c,m]=(0,d.useState)(!1),x=(0,u.FR)((0,u.MS)(u.AN,{activationConstraint:{distance:5}}),(0,u.MS)(u.cA,{activationConstraint:{distance:5}}),(0,u.MS)(u.IG,{activationConstraint:{distance:5}}));return(0,l.jsx)(u.Mp,{onDragEnd:function(e){let{active:a,over:l}=e;a.id!==l.id&&t(e=>{let t=e.findIndex(e=>e.__dndId===a.id),n=e.findIndex(e=>e.__dndId===l.id);return(0,o.be)(e,t,n)}),m(!1)},onDragStart:()=>m(!0),sensors:x,children:(0,l.jsx)(o.gB,{items:a.map(e=>({...e,id:e.__dndId})),strategy:o._G,children:(0,l.jsxs)(C,{droppableId:"droppable",isDragging:c,children:["receitas"===i&&(0,l.jsx)("li",{className:"list-group-item list-group-item-success",children:"Receitas"}),"despesas"===i&&(0,l.jsx)("li",{className:"list-group-item list-group-item-danger",children:"Despesas"}),"semValor"===i&&(0,l.jsx)("li",{className:"list-group-item list-group-item-warning",children:"Sem Valor"}),a.map((e,a)=>(0,l.jsx)(w,{id:e.__dndId,children:(0,l.jsx)(I,{item:e,tableName:s,setEditTransacao:r,removerTransacao:n})},(null==e?void 0:e.__dndId)||a))]})})})}function C(e){let{droppableId:a,isDragging:t,children:n}=e,{setNodeRef:s}=(0,u.zM)({id:a||"droppable"});return(0,l.jsx)("ul",{ref:s,className:"list-group ".concat(t&&"text-bg-dark"),children:n})}function w(e){let{attributes:a,listeners:t,setNodeRef:n,transform:s,transition:r}=(0,o.gl)({id:e.id}),i={transform:c.Ks.Transform.toString(s),transition:r,touchAction:"none"};return(0,l.jsx)("li",{className:"list-group-item",ref:n,style:i,...t,...a,children:e.children})}function I(e){var a,t,n;let{item:s,tableName:i,setEditTransacao:o,removerTransacao:c}=e,{repository:d}=(0,N.r)(),u=i===p.tw.PATRIMONIO?"":"(".concat((null==d||null==(t=d.categoriaTransacoes)||null==(a=t.TODAS_DICT[s.categoriaId])?void 0:a.descricao)||"Sem categoria",")");return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,l.jsxs)("h5",{children:[s.local," ",(0,l.jsx)("small",{className:"text-secondary",children:u})]}),(0,l.jsxs)("div",{className:"d-flex justify-content-between gap-3",children:[(0,l.jsx)("small",{children:r()(s.data).format("DD/MM/YY")}),void 0!==s.tipo&&(0,l.jsx)("small",{className:s.tipo===j.Do.FIXO?"text-primary":"text-info",children:s.tipo===j.Do.FIXO?"Fixo":"Vari\xe1vel"})]})]}),(0,l.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,l.jsx)("p",{children:(null==(n=s.valor)?void 0:n.toNumber())?h.S.toCurrency(s.valor):"sem valor"}),(0,l.jsxs)("div",{className:"d-flex gap-3 flex-column flex-lg-row",children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>o(s),children:"Editar"}),(0,l.jsx)("button",{className:"btn btn-danger",onClick:()=>c(s),children:"Remover"})]})]}),(0,l.jsx)("small",{children:s.comentario})]})}function M(e){let{total:a}=e;return(0,l.jsxs)("div",{className:"d-flex gap-3",children:[(0,l.jsx)("h5",{children:"Balan\xe7o do m\xeas"}),(0,l.jsxs)("div",{className:"d-flex flex-column",children:[(0,l.jsx)("p",{className:"m-0",children:h.S.toCurrency(a)}),(0,l.jsx)("small",{children:h.S.extenso(a)})]})]})}}}]);