"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{5814:function(e,a,l){l.d(a,{V:function(){return v}});var t=l(7437),n=l(2151),s=l.n(n),o=l(7907),i=l(3694),r=l(2265),c=l(8034),d=l(6468),m=l(6274),u=l(620),x=l(2021),f=l(5507),h=l(2111),b=l(2840),p=l(7225);let j=new Date;function v(e){let{isCopy:a,tableName:l}=e,n=l||c.H$.TRANSACOES,{params:v}=(0,p.T)(),g=v.get("month"),y=s()(g,"YYYY-MM"),C=(0,o.useRouter)(),{isDbOk:w,repository:S}=(0,i.y)(),[F,k]=(0,r.useState)(!0),[I,D]=(0,r.useState)(j),[A,O]=(0,r.useState)([]),[E,M]=(0,r.useState)([]),[R,P]=(0,r.useState)(),[Y,L]=(0,r.useState)(!1),$=n===c.H$.PATRIMONIO;async function V(){let e;k(!0),e=n===c.H$.PATRIMONIO?await S.patrimonio.listByMonth(y.format("MM"),y.format("YYYY")):await S.transacoes.listByMonth(y.format("MM"),y.format("YYYY")),a&&e.forEach(e=>{delete e.id,delete e.createdDate,delete e.updatedDate,e.data=j}),O(e),k(!1)}async function T(){if(!confirm("Voc\xea tem certeza?"))return;k(!0);let e=[...A];a&&e.forEach(e=>{e.data=e.data===j?I:e.data}),e.forEach((e,a)=>{e.ordem=a}),await Promise.all(E.filter(e=>e.id).map(e=>S.delete(n,e.id))),await S.saveAll(n,e),k(!1),C.push($?"/patrimonio":"/caixa")}function Z(e){let a=A.indexOf(e),l=[...A];l.splice(a,1),O(l),M([...E,e])}(0,r.useEffect)(()=>{w&&V()},[w]);let H=A.filter(e=>null==e?void 0:e.valor).reduce((e,a)=>a.valor.plus(e),(0,b.Z)(0));return(0,t.jsxs)(t.Fragment,{children:[F?(0,t.jsx)(d.a,{className:"align-self-center my-5"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center align-items-lg-end flex-column flex-lg-row gap-3",children:[(0,t.jsx)(N,{total:H}),(0,t.jsx)("div",{className:"d-flex gap-3 flex-column flex-lg-row",children:(0,t.jsx)("button",{type:"button",className:"btn btn-dark",onClick:e=>L(!0),children:"Adicionar nova"})})]}),(0,t.jsx)(h.Z5,{onDragEnd:function(e){var a;let l=[...A],t=null===(a=e.destination)||void 0===a?void 0:a.index,n=e.source.index,s=l[n];l.splice(n,1),l.splice(t,0,s),O(l)},children:(0,t.jsx)(h.bK,{droppableId:"droppable",children:(e,a)=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("ul",{...e.droppableProps,className:"list-group ".concat(a.isDraggingOver&&"text-bg-dark"),ref:e.innerRef,children:A.map((e,a)=>(0,t.jsx)(h._l,{draggableId:"".concat(e.local,":").concat(a),index:a,children:(a,l)=>{var n,o;return(0,t.jsxs)("li",{ref:a.innerRef,...a.draggableProps,...a.dragHandleProps,style:a.draggableProps.style,className:"list-group-item ".concat(!(null===(n=e.valor)||void 0===n?void 0:n.toNumber())&&"list-group-item-warning"," ").concat(l.isDragging&&"active"),children:[(0,t.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,t.jsx)("h5",{children:e.local}),(0,t.jsxs)("div",{className:"d-flex justify-content-between gap-3",children:[(0,t.jsx)("small",{children:s()(e.data).format("DD/MM/YY")}),void 0!==e.tipo&&(0,t.jsx)("small",{className:e.tipo===c.$P.FIXO?"text-primary":"text-info",children:e.tipo===c.$P.FIXO?"Fixo":"Vari\xe1vel"})]})]}),(0,t.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,t.jsx)("p",{children:(null===(o=e.valor)||void 0===o?void 0:o.toNumber())?m.C.toCurrency(e.valor):"sem valor"}),(0,t.jsxs)("div",{className:"d-flex gap-3 flex-column flex-lg-row",children:[(0,t.jsx)("button",{className:"btn btn-secondary",onClick:a=>P(e),children:"Editar"}),(0,t.jsx)("button",{className:"btn btn-danger",onClick:a=>Z(e),children:"Remover"})]})]}),(0,t.jsx)("small",{children:e.comentario})]})}},"".concat(e.local,":").concat(a)))}),e.placeholder]})})}),(0,t.jsx)("div",{className:"d-flex justify-content-center justify-content-lg-end",children:(0,t.jsxs)("div",{className:"d-flex gap-3 flex-column flex-lg-row",children:[(0,t.jsx)(N,{total:H}),a&&(0,t.jsxs)("div",{className:"form-floating",children:[(0,t.jsx)(u.I,{type:"month",className:"form-control",id:"data",placeholder:"M\xeas a aplicar",value:I,onChange:e=>D(e)}),(0,t.jsx)("label",{htmlFor:"data",className:"form-label",children:"M\xeas a aplicar"})]}),(0,t.jsx)("button",{type:"button",className:"btn btn-primary",onClick:e=>T(),children:a?"Copiar transa\xe7\xf5es para o m\xeas":"Salvar transa\xe7\xf5es do m\xeas"})]})})]}),R&&(0,t.jsx)(x.u,{hideFooter:!0,onClose:()=>P(null),title:"Detalhes da transa\xe7\xe3o: ".concat(null==R?void 0:R.local),children:(0,t.jsx)(f.m,{tableName:n,transacao:R,cleanStyle:!0,onClose:()=>P(null),onCustomSubmit:e=>(function(e,a){let l=A.indexOf(e),t=[...A];t[l]={...a},O(t)})(R,e),onCustomDelete:e=>Z(R)})}),Y&&(0,t.jsx)(x.u,{hideFooter:!0,onClose:()=>L(!1),title:"Adicionar transa\xe7\xe3o",children:(0,t.jsx)(f.m,{tableName:n,cleanStyle:!0,onClose:()=>L(!1),onCustomSubmit:e=>(function(e){let a=[...A];a.push(e),O(a)})(e),onCustomDelete:e=>L(!1)})})]})}function N(e){let{total:a}=e;return(0,t.jsxs)("div",{className:"d-flex gap-3",children:[(0,t.jsx)("h5",{children:"Balan\xe7o do m\xeas"}),(0,t.jsxs)("div",{className:"d-flex flex-column",children:[(0,t.jsx)("p",{className:"m-0",children:m.C.toCurrency(a)}),(0,t.jsx)("small",{children:m.C.extenso(a)})]})]})}},5507:function(e,a,l){l.d(a,{m:function(){return d}});var t=l(7437),n=l(8034),s=l(620),o=l(2265),i=l(2840),r=l(3694),c=l(648);function d(e){let{transacao:a,cleanStyle:l,onClose:d,onCustomSubmit:f,onCustomDelete:h,tableName:b}=e,p=b||n.H$.TRANSACOES,{isDbOk:j,repository:v,refresh:N}=(0,r.y)(),{isMobile:g}=(0,c.k)(),[y,C]=(0,o.useState)((null==a?void 0:a.valor)||(0,i.Z)()),[w,S]=(0,o.useState)((null==a?void 0:a.data)||new Date),[F,k]=(0,o.useState)(null==a?void 0:a.tipo),[I,D]=(0,o.useState)(null==a?void 0:a.local),[A,O]=(0,o.useState)(null==a?void 0:a.comentario),[E,M]=(0,o.useState)(!1),R=p===n.H$.PATRIMONIO;async function P(e){e.preventDefault(),M(!0);let l={...a,valor:y,data:w,tipo:F,local:I,comentario:A};p===n.H$.PATRIMONIO&&delete l.tipo,null==f?(console.info("onSubmitForm",await v.save(p,l)),await N()):f(l),M(!1),d&&d()}async function Y(){if(M(!0),null==a)throw Error("transacao invalida");null==h?(console.info("onDelete",await v.delete(p,a.id)),N()):h(a),M(!1),d&&d()}return(0,t.jsxs)("form",{className:"transacao-form w-100 ".concat(!l&&"card"),onSubmit:P,children:[!l&&(0,t.jsx)("h5",{className:"card-header",children:"Adicionar novo(a)"}),(0,t.jsxs)("div",{className:"d-flex flex-column px-3 py-2 gap-3",children:[(0,t.jsxs)("div",{className:"d-flex gap-3 flex-column flex-md-row w-100",children:[(0,t.jsxs)("div",{className:"flex-grow-1 ".concat(!R&&"w-100"),children:[(0,t.jsx)("label",{htmlFor:"local",className:"form-label",children:"Local"}),(0,t.jsx)(s.I,{type:"text",className:"form-control",id:"local",onChange:e=>D(e),value:I,placeholder:"Local"})]}),(0,t.jsxs)("div",{className:"flex-grow-1",children:[(0,t.jsx)("label",{htmlFor:"valorAplicado",className:"form-label",children:"Valor aplicado"}),(0,t.jsx)(s.I,{type:"number",className:"form-control",id:"valorAplicado",groupSymbolLeft:"R$",onChange:e=>C(e),value:y})]}),R?(0,t.jsx)(m,{data:w,setData:S,isPatrimonio:R}):null]}),(0,t.jsxs)("div",{className:"d-flex gap-3 flex-column flex-md-row w-100",children:[(0,t.jsx)(u,{comentario:A,setComentario:O}),(0,t.jsxs)("div",{className:"d-flex gap-3 flex-column",children:[R?null:(0,t.jsx)(m,{data:w,setData:S,isPatrimonio:R}),R?null:(0,t.jsxs)("div",{className:"flex-grow-1",children:[(0,t.jsx)("label",{htmlFor:"tipoReceita",className:"form-label",children:"Tipo de receita"}),(0,t.jsxs)("select",{className:"form-select ".concat(!g&&"form-control-sm"),id:"tipoReceita",onChange:e=>k(Number(e.target.value)),defaultValue:F,children:[(0,t.jsx)("option",{value:n.$P.VARIAVEL,children:"Vari\xe1vel"}),(0,t.jsx)("option",{value:n.$P.FIXO,children:"Fixo"})]})]})]})]}),(0,t.jsx)(x,{isAllLoading:!j||E,transacao:a,onClose:d,onDelete:Y,onReset:function(){C((0,i.Z)()),S(new Date),k(n.$P.VARIAVEL),D(""),O("")}})]})]})}function m(e){let{setData:a,data:l,isPatrimonio:n}=e,{isMobile:o}=(0,c.k)();return(0,t.jsxs)("div",{className:"flex-grow-1",children:[(0,t.jsx)("label",{htmlFor:"data",className:"form-label",children:"Data"}),(0,t.jsx)(s.I,{type:"date",className:"form-control ".concat(!o&&!n&&"form-control-sm"),id:"data",onChange:e=>a(e),value:l})]})}function u(e){let{setComentario:a,comentario:l}=e;return(0,t.jsxs)("div",{className:"flex-grow-1 d-flex flex-column",children:[(0,t.jsx)("label",{htmlFor:"comentario",className:"form-label",children:"Comentario (OBS)"}),(0,t.jsx)(s.I,{type:"mdtextarea",className:"form-control h-100",id:"comentario",onChange:e=>a(e),value:l,placeholder:"Comentario (OBS)"})]})}function x(e){let{isAllLoading:a,transacao:l,onClose:n,onDelete:s,onReset:o}=e,i="Adicionar";null!=l&&(i="Salvar");let r=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"spinner-border spinner-border-sm","aria-hidden":"true"}),(0,t.jsxs)("span",{role:"status",children:[" ","..."]})]});return(0,t.jsxs)("div",{className:"d-flex gap-2 justify-content-end",children:[n&&(0,t.jsx)("button",{type:"button",onClick:n,className:"btn btn-secondary align-self-end mt-2",disabled:a,children:a?r:"Fechar"}),l&&s&&(0,t.jsx)("button",{type:"button",onClick:s,className:"btn btn-danger align-self-end mt-2",disabled:a,children:a?r:"Remover"}),o&&(0,t.jsx)("button",{type:"button",onClick:o,className:"btn btn-light align-self-end mt-2",disabled:a,children:"Limpar campos"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary align-self-end mt-2",disabled:a,children:a?r:i})]})}},2021:function(e,a,l){l.d(a,{u:function(){return s}});var t=l(7437),n=l(2265);function s(e){let{children:a,title:l,onClose:s,hideFooter:o}=e,[i,r]=(0,n.useState)(!0);function c(){r(!1),s&&s()}function d(e){var a;(null==e?void 0:null===(a=e.target)||void 0===a?void 0:a.id)==="modal"&&c()}function m(e){(null==e?void 0:e.key)==="Escape"&&c()}return(0,n.useEffect)(()=>(document.addEventListener("keydown",m,!1),()=>{document.removeEventListener("keydown",m,!1)}),[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"modal modal-lg fade ".concat(i&&"show"),id:"modal",tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",style:{zIndex:99,display:i?"block":"none"},onClick:d,children:(0,t.jsx)("div",{className:"modal-dialog",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",id:"exampleModalLabel",children:l}),(0,t.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:c})]}),(0,t.jsx)("div",{className:"modal-body",children:a}),!o&&(0,t.jsx)("div",{className:"modal-footer",children:(0,t.jsx)("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",onClick:c,children:"Close"})})]})})}),(0,t.jsx)("div",{className:"modal-backdrop fade ".concat(i&&"show"),style:{zIndex:98},onClick:d})]})}},6274:function(e,a,l){l.d(a,{C:function(){return r}});var t=l(2840),n=l(6947),s=l.n(n);let o=new Intl.NumberFormat("pt-br",{style:"currency",currency:"BRL"}),i=new Intl.NumberFormat("pt-br",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2});class r{static bigNumberToNumber(e){let a={...e};return Object.keys(a).forEach(e=>{let l=a[e];l instanceof t.Z?a[e]=null==l?void 0:l.toNumber():"object"==typeof l&&(a[e]=r.bigNumberToNumber(l))}),a}static extenso(e,a){var l;return(e instanceof t.Z&&(e=null==e?void 0:null===(l=e.integerValue())||void 0===l?void 0:l.toNumber()),null==e||isNaN(e)||!isFinite(e))?"":s()(e,a)}static toCurrency(e){return("string"==typeof e&&(e=Number(e)),e instanceof t.Z&&(e=null==e?void 0:e.toNumber()),null==e||isNaN(e)||!isFinite(e))?"":o.format(e)}static toPercent(e){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return("string"==typeof e&&(e=Number(e)),e instanceof t.Z&&(e=null==e?void 0:e.toNumber()),null==e||isNaN(e)||!isFinite(e))?"":(a&&(e/=100),i.format(e))}}}}]);