(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{4711:function(e,a,l){Promise.resolve().then(l.bind(l,980))},980:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return O}});var s=l(7437);l(6178);var n=l(3930),t=l(5309),o=l(2265),r=l(8034),i=l(2151),c=l.n(i),d=l(6468);let m=[{title:"ultimo mes",value:r.Jd.ULTIMO_MES},{title:"3 ultimos meses",value:r.Jd.TRES_ULTIMOS_MESES},{title:"6 ultimos meses",value:r.Jd.SEIS_ULTIMOS_MESES},{title:"ultimo ano",value:r.Jd.ULTIMO_ANO},{title:"todo historico",value:r.Jd.TODO_HISTORICO}];function u(e){let{onChange:a,value:l}=e;return(0,s.jsxs)("form",{className:"periodo-form card",children:[(0,s.jsx)("h5",{className:"card-header",children:"Escolha o periodo"}),(0,s.jsx)("div",{className:"btn-group my-3 px-3",children:m.map((e,n)=>(0,s.jsxs)("label",{className:"btn btn-outline-secondary ".concat(e.value===l&&"active"),htmlFor:"periodosTransacoes".concat(n),children:[(0,s.jsx)("input",{type:"radio",className:"btn-check",name:"periodosTransacoes",id:"periodosTransacoes".concat(n),value:e.value,onChange:e=>a(Number(e.target.value)),checked:e.value===l}),e.title]},e.value))})]})}var x=l(2840),h=l(6947),j=l.n(h);let v=new Intl.NumberFormat("pt-br",{style:"currency",currency:"BRL"});class p{static extenso(e,a){var l;return(e instanceof x.Z&&(e=null==e?void 0:null===(l=e.integerValue())||void 0===l?void 0:l.toNumber()),null==e||isNaN(e)||!isFinite(e))?"":j()(e,a)}static toCurrency(e,a){return("string"==typeof e&&(e=Number(e)),e instanceof x.Z&&(e=null==e?void 0:e.toNumber()),null==e||isNaN(e)||!isFinite(e))?"":v.format(e)}}function f(e){let{children:a,title:l,onClose:n,hideFooter:t}=e,[r,i]=(0,o.useState)(!0);function c(){i(!1),n&&n()}function d(e){var a;(null==e?void 0:null===(a=e.target)||void 0===a?void 0:a.id)==="modal"&&c()}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"modal modal-lg fade ".concat(r&&"show"),id:"modal",tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",style:{zIndex:99,display:r?"block":"none"},onClick:d,children:(0,s.jsx)("div",{className:"modal-dialog",children:(0,s.jsxs)("div",{className:"modal-content",children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsx)("h5",{className:"modal-title",id:"exampleModalLabel",children:l}),(0,s.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:c})]}),(0,s.jsx)("div",{className:"modal-body",children:a}),!t&&(0,s.jsx)("div",{className:"modal-footer",children:(0,s.jsx)("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",onClick:c,children:"Close"})})]})})}),(0,s.jsx)("div",{className:"modal-backdrop fade ".concat(r&&"show"),style:{zIndex:98},onClick:d})]})}function b(e){let{onChange:a,isNumber:l,groupSymbolLeft:n,groupSymbolRight:t,isPercent:o,value:r,...i}=e,d="number"===e.type||l,m="date"===e.type,u=d?function(e,a){let{isPercent:l}=a;return null==e||isNaN(e.toNumber())?"":l?e.times(100).toNumber():e.toNumber()}(r,{isPercent:o}):m?c()(r).format("YYYY-MM-DD"):r||"",h=(0,s.jsx)("input",{className:"form-control",onChange:function(e){let{value:l}=e.target;(a||function(){})(o?(0,x.Z)(l).div(100):d?(0,x.Z)(l):m?c()(l,"YYYY-MM-DD").toDate():l)},value:u,...i});return n||t?(0,s.jsxs)("div",{className:"input-group mb-3",children:[n&&(0,s.jsx)("span",{className:"input-group-text",children:n}),h,t&&(0,s.jsx)("span",{className:"input-group-text",children:t})]}):h}function N(e){let{transacao:a,cleanStyle:l,onClose:n}=e;console.log("transacao",a);let{isDbOk:i,repository:c,refresh:d}=(0,t.y$)(),[m,u]=(0,o.useState)((null==a?void 0:a.valor)||(0,x.Z)()),[h,j]=(0,o.useState)((null==a?void 0:a.data)||new Date),[v,p]=(0,o.useState)(null==a?void 0:a.tipo),[f,N]=(0,o.useState)(null==a?void 0:a.local),[y,S]=(0,o.useState)(null==a?void 0:a.comentario),[C,w]=(0,o.useState)(!1);async function M(e){w(!0),e.preventDefault();let l={...a,valor:m,data:h,tipo:v,local:f,comentario:y};console.info("onSubmitForm",await c.save(r.H$.TRANSACOES,l)),await d(),w(!1),n&&n()}async function O(){if(w(!0),null==a)throw Error("transacao invalida");console.info("onDelete",await c.delete(r.H$.TRANSACOES,a.id)),d(),w(!1),n&&n()}return(0,s.jsxs)("form",{className:"transacao-form w-100 ".concat(!l&&"card"),onSubmit:M,children:[!l&&(0,s.jsx)("h5",{className:"card-header",children:"Adicione uma nova transa\xe7\xe3o"}),(0,s.jsxs)("div",{className:"d-flex flex-column px-3 py-2",children:[(0,s.jsxs)("div",{className:"d-flex w-100 mb-3",children:[(0,s.jsxs)("div",{className:"flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"local",className:"form-label",children:"Local"}),(0,s.jsx)(b,{type:"text",className:"form-control",id:"local",onChange:e=>N(e),value:f,placeholder:"Local"})]}),(0,s.jsxs)("div",{className:"ms-3 flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"comentario",className:"form-label",children:"Comentario (OBS)"}),(0,s.jsx)(b,{type:"text",className:"form-control",id:"comentario",onChange:e=>S(e),value:y,placeholder:"Comentario (OBS)"})]})]}),(0,s.jsxs)("div",{className:"d-flex w-100",children:[(0,s.jsxs)("div",{className:"flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"valorAplicado",className:"form-label",children:"Valor aplicado"}),(0,s.jsx)(b,{type:"number",className:"form-control",id:"valorAplicado",groupSymbolLeft:"R$",onChange:e=>u(e),value:m})]}),(0,s.jsxs)("div",{className:"ms-3 flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"data",className:"form-label",children:"Data"}),(0,s.jsx)(b,{type:"date",className:"form-control",id:"data",onChange:e=>j(e),value:h})]}),(0,s.jsxs)("div",{className:"ms-3 flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"tipoReceita",className:"form-label",children:"Tipo de receita"}),(0,s.jsxs)("select",{className:"form-select",id:"tipoReceita",onChange:e=>p(e.target.value),defaultValue:v,children:[(0,s.jsx)("option",{value:r.$P.VARIAVEL,children:"Vari\xe1vel"}),(0,s.jsx)("option",{value:r.$P.FIXO,children:"Fixo"})]})]})]}),(0,s.jsx)(g,{isAllLoading:!i||C,transacao:a,onClose:n,onDelete:O})]})]})}function g(e){let{isAllLoading:a,transacao:l,onClose:n,onDelete:t}=e,o="Adicionar";return null!=l&&(o="Salvar"),(0,s.jsxs)("div",{className:"d-flex gap-2 justify-content-end",children:[n&&(0,s.jsx)("button",{type:"button",onClick:n,className:"btn btn-secondary align-self-end mt-2",disabled:a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner-border spinner-border-sm","aria-hidden":"true"}),(0,s.jsxs)("span",{role:"status",children:[" ","Carregando..."]})]}):"Fechar"}),l&&t&&(0,s.jsx)("button",{type:"button",onClick:t,className:"btn btn-danger align-self-end mt-2",disabled:a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner-border spinner-border-sm","aria-hidden":"true"}),(0,s.jsxs)("span",{role:"status",children:[" ","Carregando..."]})]}):"Remover"}),(0,s.jsx)("button",{type:"submit",className:"btn btn-primary w-25 align-self-end mt-2",disabled:a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner-border spinner-border-sm","aria-hidden":"true"}),(0,s.jsxs)("span",{role:"status",children:[" ","Carregando..."]})]}):o})]})}function y(e){let{periodo:a}=e,[l,n]=(0,o.useState)(null);return(0,s.jsxs)("ul",{className:"list-group",children:[a.map((e,a)=>{var l;return(0,s.jsxs)("li",{className:"list-group-item ".concat(null!==(l=e.valor)&&void 0!==l?l:"list-group-item-warning"),children:[(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,s.jsx)("h5",{children:e.local}),(0,s.jsxs)("div",{className:"d-flex justify-content-between gap-3",children:[(0,s.jsx)("small",{children:c()(e.data).format("DD/MM/YY")}),(0,s.jsx)("small",{className:e.tipo===r.$P.FIXO?"text-primary":"text-info",children:e.tipo===r.$P.FIXO?"Fixo":"Vari\xe1vel"})]})]}),(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,s.jsx)("p",{children:e.valor?p.toCurrency(e.valor):"sem valor"}),(0,s.jsx)("button",{className:"btn btn-secondary",onClick:a=>n(e),children:"Editar"})]}),(0,s.jsx)("small",{children:e.comentario})]},"".concat(e.local,":").concat(a))}),l&&(0,s.jsx)(f,{hideFooter:!0,onClose:()=>n(null),title:"Detalhes da transa\xe7\xe3o: ".concat(l.local),children:(0,s.jsx)(N,{transacao:l,cleanStyle:!0,onClose:()=>n(null)})})]})}var S=l(1196);function C(e){let{periodo:a}=e,l=a.reduce((e,a)=>e.plus(a.valor||0),(0,x.Z)(0));return(0,s.jsxs)("div",{className:"totals",children:[(0,s.jsx)("h5",{children:"Balan\xe7o do mes"}),(0,s.jsx)("p",{children:p.toCurrency(l)}),(0,s.jsx)("small",{children:p.extenso(l)}),(0,s.jsx)(w,{periodo:a})]})}function w(e){let{periodo:a}=e,l=a.filter(e=>{var a;return e.valor&&(null===(a=e.valor)||void 0===a?void 0:a.toNumber())>=0}).reduce((e,a)=>e.plus(a.valor||0),(0,x.Z)(0)),n=a.filter(e=>{var a;return e.valor&&(null===(a=e.valor)||void 0===a?void 0:a.toNumber())<0}).reduce((e,a)=>e.plus(a.valor||0),(0,x.Z)(0));return(0,s.jsx)(S.$I,{data:{labels:["Entradas","Saidas"],datasets:[{label:"soma em reais (R$)",data:[l,n],backgroundColor:["#65a148","#dc3545"],hoverOffset:4}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}function M(){let{isDbOk:e,repository:a}=(0,t.y$)(),[l,n]=(0,o.useState)(!0),[i,m]=(0,o.useState)({}),[x,h]=(0,o.useState)(r.Jd.ULTIMO_MES);async function j(){n(!0);let e=await a.list(r.H$.TRANSACOES,x),l={};e.forEach(e=>{let a=c()(e.data).format("YYYY-MM"),s=l[a]||[];s.push(e),l[a]=s}),m(l),n(!1)}return(0,o.useEffect)(()=>{console.log("page. isDbOk",e),e&&j()},[e,x]),(0,s.jsxs)("main",{className:"caixa container mt-3",children:[(0,s.jsx)("h1",{children:"Caixa"}),(0,s.jsxs)("article",{className:"transacoes",children:[(0,s.jsxs)("section",{className:"forms",children:[(0,s.jsx)(u,{onChange:e=>h(e),value:x}),(0,s.jsx)(N,{})]}),(0,s.jsx)("section",{className:"periodos",children:l?(0,s.jsx)(d.a,{className:"align-self-center my-5"}):Object.keys(i).map(e=>{let a=i[e];return(0,s.jsxs)("section",{className:"card my-3",children:[(0,s.jsxs)("h4",{className:"card-header",children:["Periodo de: ",c()(e,"YYYY-MM").format("MMMM YYYY")]}),(0,s.jsxs)("div",{className:"card-body d-flex justify-content-around",children:[(0,s.jsx)(y,{periodo:a}),(0,s.jsx)(C,{periodo:a})]})]},e)})})]})]})}function O(){return(0,s.jsx)(n.A,{children:(0,s.jsx)(M,{})})}},6178:function(){}},function(e){e.O(0,[674,218,990,935,964,899,156,971,69,744],function(){return e(e.s=4711)}),_N_E=e.O()}]);