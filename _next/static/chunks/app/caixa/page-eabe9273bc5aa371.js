(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{4711:function(e,a,t){Promise.resolve().then(t.bind(t,6864))},7644:function(e,a,t){"use strict";t.d(a,{w:function(){return o}});var s=t(7437),l=t(8827);let n=[{title:"ultimo mes",value:l.Jd.ULTIMO_MES},{title:"3 ultimos meses",value:l.Jd.TRES_ULTIMOS_MESES},{title:"6 ultimos meses",value:l.Jd.SEIS_ULTIMOS_MESES},{title:"ultimo ano",value:l.Jd.ULTIMO_ANO},{title:"todo historico",value:l.Jd.TODO_HISTORICO}];function o(e){let{onChange:a,value:t}=e;return(0,s.jsxs)("form",{className:"periodo-form card",children:[(0,s.jsx)("h5",{className:"card-header",children:"Escolha o periodo"}),(0,s.jsx)("div",{className:"d-xl-none my-3 px-3",children:(0,s.jsx)("select",{className:"form-select",id:"tipoReceita",onChange:e=>a(Number(e.target.value)),defaultValue:t,children:n.map((e,a)=>(0,s.jsx)("option",{value:e.value,children:e.title},e.value))})}),(0,s.jsx)("div",{className:"d-none d-xl-flex btn-group my-3 px-3",children:n.map((e,l)=>(0,s.jsxs)("label",{className:"btn btn-outline-secondary ".concat(e.value===t&&"active"),htmlFor:"periodosTransacoes".concat(l),children:[(0,s.jsx)("input",{type:"radio",className:"btn-check",name:"periodosTransacoes",id:"periodosTransacoes".concat(l),value:e.value,onChange:e=>a(Number(e.target.value)),checked:e.value===t}),e.title]},e.value))})]})}},2163:function(e,a,t){"use strict";t.d(a,{B:function(){return g}});var s=t(7437),l=t(2151),n=t.n(l),o=t(6468),r=t(6274),c=t(2265),i=t(2021),d=t(2018),u=t(1227),m=t(8827),x=t(4882);function f(e){let{transacoesDoPeriodo:a,tableName:t}=e,l=t||u.H$.TRANSACOES,[n,o]=(0,c.useState)(null);return(0,s.jsxs)("ul",{className:"list-group w-100 mx-3",children:[a.map((e,a)=>(0,s.jsx)(h,{item:e,setTransaction:o},"".concat(e.local,":").concat(a))),n&&(0,s.jsx)(i.u,{hideFooter:!0,onClose:()=>o(null),title:"Detalhes da transa\xe7\xe3o: ".concat(null==n?void 0:n.local),children:(0,s.jsx)(d.m,{tableName:l,transacao:n,cleanStyle:!0,onClose:()=>o(null)})})]})}function h(e){var a;let{item:t,setTransaction:l}=e,[o,i]=(0,c.useState)(t);return(0,c.useEffect)(()=>{let e={...t};e.__parsedComentario=x.u.render(t.comentario),i(e)},[t]),(0,s.jsxs)("li",{className:"list-group-item ".concat(null!==(a=t.valor)&&void 0!==a?a:"list-group-item-warning"),children:[(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,s.jsx)("h5",{children:t.local}),(0,s.jsxs)("div",{className:"d-flex justify-content-between gap-3 flex-column flex-lg-row",children:[(0,s.jsx)("small",{children:n()(t.data).format("DD/MM/YY")}),void 0!==t.tipo&&(0,s.jsx)("small",{className:t.tipo===m.$P.FIXO?"text-primary":"text-info",children:t.tipo===m.$P.FIXO?"Fixo":"Vari\xe1vel"})]})]}),(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,s.jsx)("p",{children:t.valor?r.C.toCurrency(t.valor):"sem valor"}),(0,s.jsx)("button",{className:"btn btn-secondary",onClick:e=>l(t),children:"Editar"})]}),(0,s.jsx)("small",{dangerouslySetInnerHTML:{__html:o.__parsedComentario}})]})}var j=t(1196),v=t(2840);function p(e){let{transacoesDoPeriodo:a,transacoesAcumuladasPorMes:t}=e,l=a.reduce((e,a)=>e.plus(a.valor||0),(0,v.Z)(0));return(0,s.jsxs)("div",{className:"totals",children:[(0,s.jsx)("h5",{children:"Balan\xe7o do mes"}),(0,s.jsx)("p",{children:r.C.toCurrency(l)}),(0,s.jsx)("small",{children:r.C.extenso(l)}),(0,s.jsx)(b,{transacoesAcumuladasPorMes:t}),(0,s.jsx)(N,{transacoesDoPeriodo:a})]})}function N(e){let{transacoesDoPeriodo:a}=e,t=a.filter(e=>{var a;return e.valor&&(null===(a=e.valor)||void 0===a?void 0:a.toNumber())>=0}).reduce((e,a)=>e.plus(a.valor||0),(0,v.Z)(0)),l=a.filter(e=>{var a;return e.valor&&(null===(a=e.valor)||void 0===a?void 0:a.toNumber())<0}).reduce((e,a)=>e.plus(a.valor||0),(0,v.Z)(0));return(0,s.jsx)(j.$I,{data:{labels:["Entradas","Saidas"],datasets:[{label:"soma em reais (R$)",data:[t,l],backgroundColor:["#65a148","#dc3545"],hoverOffset:4}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}function b(e){let{transacoesAcumuladasPorMes:a}=e;return(0,s.jsx)(j.x1,{data:{labels:a.map(e=>e.mes),datasets:[{label:"acumulado at\xe9 o mes (R$)",data:a.map(e=>e.totalAcumulado)}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}var M=t(8792),y=t(5631);function g(e){let{groupByDay:a,periodo:t,transacoesAcumuladaPorMes:l,tableName:i}=e,{isDbOk:d,repository:m,refresh:x}=(0,y.y)(),[h,j]=(0,c.useState)(!0),[N,b]=(0,c.useState)({}),g=i||u.H$.TRANSACOES,C=a?"YYYY-MM-DD":"YYYY-MM",Y=a?"DD MMMM YYYY":"MMMM YYYY";async function S(){j(!0),await O(),j(!1)}async function O(){b((g===u.H$.PATRIMONIO?await m.patrimonio.listPatrimonio(t):await m.transacoes.listCaixa(t)).reduce((e,a)=>{let t=n()(a.data).format(C),s=e[t]||[];return s.push(a),e[t]=s,e},{}))}async function w(e){confirm("Voc\xea tem certeza que deseja remover o m\xeas?")&&(g===u.H$.PATRIMONIO?await m.patrimonio.deletePeriod(e.format("MM"),e.format("YYYY")):await m.transacoes.deletePeriod(e.format("MM"),e.format("YYYY")),await x())}(0,c.useEffect)(()=>{d&&S()},[d,t]);let E=Object.keys(N),_=g===u.H$.PATRIMONIO,A=_?"patrimonio":"caixa";return(0,s.jsx)("section",{className:"periodos",children:h?(0,s.jsx)(o.a,{className:"align-self-center my-5"}):0===E.length?(0,s.jsx)("div",{className:"alert alert-info my-3",role:"alert",children:"Nenhum dado encontrado"}):E.map(e=>{let a=N[e]||[],{acumulado:t,acumuladoAteOMes:o}=function(e,a){if(null==e)return{acumulado:{},acumuladoAteOMes:[]};let t=e[a]||{},s=n()(t.mes,"YYYY-MM"),l=s.clone().add(-5,"month");return{acumulado:t,acumuladoAteOMes:Object.values(e||{}).filter(e=>{let a=n()(e.mes,"YYYY-MM");return a.isSameOrAfter(l)&&a.isSameOrBefore(s)})}}(l,e),c=a.map(e=>e.valor).filter(Boolean).reduce((e,a)=>e.plus(a),(0,v.Z)(0)),i=n()(e,C);return(0,s.jsxs)("section",{className:"card my-3",children:[(0,s.jsxs)("div",{className:"card-header d-flex justify-content-between align-items-center flex-column flex-lg-row gap-3",children:[(0,s.jsxs)("h4",{className:"m-0",children:["Periodo de: ",i.format(Y)]}),(null==t?void 0:t.totalAcumulado)&&(0,s.jsxs)("small",{children:["Valor em caixa no periodo: ",r.C.toCurrency(t.totalAcumulado)]}),(0,s.jsxs)("div",{className:"actions d-flex gap-3",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>w(i),children:"Remover M\xeas"}),(0,s.jsx)(M.default,{href:"/".concat(A,"/editar-mes?month=").concat(e),className:"btn btn-outline-dark btn-sm",children:"Editar m\xeas"}),(0,s.jsx)(M.default,{href:"/".concat(A,"/copia?month=").concat(e),className:"btn btn-outline-dark btn-sm",children:"Copiar m\xeas"})]})]}),(0,s.jsxs)("div",{className:"card-body d-flex align-items-center align-items-lg-start flex-column-reverse flex-lg-row justify-content-lg-around",children:[(0,s.jsx)(f,{tableName:g,transacoesDoPeriodo:a}),!_&&(0,s.jsx)(p,{transacoesDoPeriodo:a,transacoesAcumuladasPorMes:o}),_&&(0,s.jsxs)("div",{className:"totals",children:[(0,s.jsx)("h5",{children:"Soma de todos os saldos"}),(0,s.jsx)("p",{children:r.C.toCurrency(c)}),(0,s.jsx)("small",{children:r.C.extenso(c)})]})]})]},e)})})}},6864:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return f}});var s=t(7437);t(6178);var l=t(8323),n=t(5631),o=t(2265),r=t(8827),c=t(7644),i=t(2018),d=t(6274),u=t(2163),m=t(6468);function x(){let{isDbOk:e,repository:a}=(0,n.y)(),[t,l]=(0,o.useState)(r.Jd.ULTIMO_MES),[x,f]=(0,o.useState)(!0),[h,j]=(0,o.useState)(),[v,p]=(0,o.useState)({});async function N(){f(!0),await b(),f(!1)}async function b(){var e;let t=await a.transacoes.totaisCaixa();console.info("loadTotals",t),j(t.valorEmCaixa),p(null===(e=t.transacoesAcumuladaPorMes)||void 0===e?void 0:e.reduce((e,a)=>(e[a.mes]=a,e),{}))}return(0,o.useEffect)(()=>{document.title="Caixa | ".concat("Gest\xe3o financeira")},[]),(0,o.useEffect)(()=>{e&&N()},[e,t]),(0,s.jsxs)("main",{className:"caixa container mt-3",children:[(0,s.jsxs)("section",{className:"d-flex justify-content-between flex-column flex-lg-row",children:[(0,s.jsx)("h1",{children:"Caixa"}),(0,s.jsxs)("div",{className:"d-flex justify-content-between gap-3",children:[(0,s.jsx)("h5",{children:"Valor em caixa: "}),x?(0,s.jsx)(m.a,{}):(0,s.jsxs)("p",{className:"d-flex flex-column",children:[d.C.toCurrency(h),(0,s.jsx)("small",{children:d.C.extenso(h,{mode:"currency",currency:{type:"BRL"}})})]})]})]}),(0,s.jsxs)("article",{className:"transacoes",children:[(0,s.jsxs)("section",{className:"forms",children:[(0,s.jsx)(c.w,{onChange:e=>l(e),value:t}),(0,s.jsx)(i.m,{})]}),(0,s.jsx)(u.B,{periodo:t,transacoesAcumuladaPorMes:v})]})]})}function f(){return(0,s.jsx)(l.A,{children:(0,s.jsx)(x,{})})}},6178:function(){}},function(e){e.O(0,[674,990,960,935,208,29,899,323,445,745,971,351,744],function(){return e(e.s=4711)}),_N_E=e.O()}]);