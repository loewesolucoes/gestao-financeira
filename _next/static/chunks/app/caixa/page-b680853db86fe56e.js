(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{4711:function(e,a,t){Promise.resolve().then(t.bind(t,1584))},5507:function(e,a,t){"use strict";t.d(a,{m:function(){return i}});var s=t(7437),l=t(8034),n=t(620),r=t(2265),o=t(2840),c=t(5309);function i(e){let{transacao:a,cleanStyle:t,onClose:i,onCustomSubmit:u,onCustomDelete:m}=e;console.log("transacao",a);let{isDbOk:f,repository:x,refresh:h}=(0,c.y$)(),[v,p]=(0,r.useState)((null==a?void 0:a.valor)||(0,o.Z)()),[j,b]=(0,r.useState)((null==a?void 0:a.data)||new Date),[N,g]=(0,r.useState)(null==a?void 0:a.tipo),[y,C]=(0,r.useState)(null==a?void 0:a.local),[S,w]=(0,r.useState)(null==a?void 0:a.comentario),[Y,M]=(0,r.useState)(!1);async function E(e){e.preventDefault(),M(!0);let t={...a,valor:v,data:j,tipo:N,local:y,comentario:S};null==u?(console.info("onSubmitForm",await x.save(l.H$.TRANSACOES,t)),await h()):u(t),M(!1),i&&i()}async function O(){if(M(!0),null==a)throw Error("transacao invalida");null==m?(console.info("onDelete",await x.delete(l.H$.TRANSACOES,a.id)),h()):m(a),M(!1),i&&i()}return(0,s.jsxs)("form",{className:"transacao-form w-100 ".concat(!t&&"card"),onSubmit:E,children:[!t&&(0,s.jsx)("h5",{className:"card-header",children:"Adicione uma nova transa\xe7\xe3o"}),(0,s.jsxs)("div",{className:"d-flex flex-column px-3 py-2 gap-3",children:[(0,s.jsxs)("div",{className:"d-flex gap-3 flex-column flex-md-row w-100",children:[(0,s.jsxs)("div",{className:"flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"local",className:"form-label",children:"Local"}),(0,s.jsx)(n.I,{type:"text",className:"form-control",id:"local",onChange:e=>C(e),value:y,placeholder:"Local"})]}),(0,s.jsxs)("div",{className:"flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"comentario",className:"form-label",children:"Comentario (OBS)"}),(0,s.jsx)(n.I,{type:"text",className:"form-control",id:"comentario",onChange:e=>w(e),value:S,placeholder:"Comentario (OBS)"})]})]}),(0,s.jsxs)("div",{className:"d-flex gap-3 flex-column flex-md-row w-100",children:[(0,s.jsxs)("div",{className:"flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"valorAplicado",className:"form-label",children:"Valor aplicado"}),(0,s.jsx)(n.I,{type:"number",className:"form-control",id:"valorAplicado",groupSymbolLeft:"R$",onChange:e=>p(e),value:v})]}),(0,s.jsxs)("div",{className:"flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"data",className:"form-label",children:"Data"}),(0,s.jsx)(n.I,{type:"date",className:"form-control",id:"data",onChange:e=>b(e),value:j})]}),(0,s.jsxs)("div",{className:"flex-grow-1",children:[(0,s.jsx)("label",{htmlFor:"tipoReceita",className:"form-label",children:"Tipo de receita"}),(0,s.jsxs)("select",{className:"form-select",id:"tipoReceita",onChange:e=>g(e.target.value),defaultValue:N,children:[(0,s.jsx)("option",{value:l.$P.VARIAVEL,children:"Vari\xe1vel"}),(0,s.jsx)("option",{value:l.$P.FIXO,children:"Fixo"})]})]})]}),(0,s.jsx)(d,{isAllLoading:!f||Y,transacao:a,onClose:i,onDelete:O})]})]})}function d(e){let{isAllLoading:a,transacao:t,onClose:l,onDelete:n}=e,r="Adicionar";return null!=t&&(r="Salvar"),(0,s.jsxs)("div",{className:"d-flex gap-2 justify-content-end",children:[l&&(0,s.jsx)("button",{type:"button",onClick:l,className:"btn btn-secondary align-self-end mt-2",disabled:a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner-border spinner-border-sm","aria-hidden":"true"}),(0,s.jsxs)("span",{role:"status",children:[" ","Carregando..."]})]}):"Fechar"}),t&&n&&(0,s.jsx)("button",{type:"button",onClick:n,className:"btn btn-danger align-self-end mt-2",disabled:a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner-border spinner-border-sm","aria-hidden":"true"}),(0,s.jsxs)("span",{role:"status",children:[" ","Carregando..."]})]}):"Remover"}),(0,s.jsx)("button",{type:"submit",className:"btn btn-primary align-self-end mt-2",disabled:a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner-border spinner-border-sm","aria-hidden":"true"}),(0,s.jsxs)("span",{role:"status",children:[" ","Carregando..."]})]}):r})]})}},1584:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return I}});var s=t(7437);t(6178);var l=t(3930),n=t(5309),r=t(2265),o=t(8034),c=t(2151),i=t.n(c),d=t(6468);let u=[{title:"ultimo mes",value:o.Jd.ULTIMO_MES},{title:"3 ultimos meses",value:o.Jd.TRES_ULTIMOS_MESES},{title:"6 ultimos meses",value:o.Jd.SEIS_ULTIMOS_MESES},{title:"ultimo ano",value:o.Jd.ULTIMO_ANO},{title:"todo historico",value:o.Jd.TODO_HISTORICO}];function m(e){let{onChange:a,value:t}=e;return(0,s.jsxs)("form",{className:"periodo-form card",children:[(0,s.jsx)("h5",{className:"card-header",children:"Escolha o periodo"}),(0,s.jsx)("div",{className:"d-xl-none my-3 px-3",children:(0,s.jsx)("select",{className:"form-select",id:"tipoReceita",onChange:e=>a(Number(e.target.value)),defaultValue:t,children:u.map((e,a)=>(0,s.jsx)("option",{value:e.value,children:e.title},e.value))})}),(0,s.jsx)("div",{className:"d-none d-xl-flex btn-group my-3 px-3",children:u.map((e,l)=>(0,s.jsxs)("label",{className:"btn btn-outline-secondary ".concat(e.value===t&&"active"),htmlFor:"periodosTransacoes".concat(l),children:[(0,s.jsx)("input",{type:"radio",className:"btn-check",name:"periodosTransacoes",id:"periodosTransacoes".concat(l),value:e.value,onChange:e=>a(Number(e.target.value)),checked:e.value===t}),e.title]},e.value))})]})}var f=t(6274),x=t(2021),h=t(5507);function v(e){let{periodo:a}=e,[t,l]=(0,r.useState)(null);return(0,s.jsxs)("ul",{className:"list-group",children:[a.map((e,a)=>{var t;return(0,s.jsxs)("li",{className:"list-group-item ".concat(null!==(t=e.valor)&&void 0!==t?t:"list-group-item-warning"),children:[(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,s.jsx)("h5",{children:e.local}),(0,s.jsxs)("div",{className:"d-flex justify-content-between gap-3",children:[(0,s.jsx)("small",{children:i()(e.data).format("DD/MM/YY")}),(0,s.jsx)("small",{className:e.tipo===o.$P.FIXO?"text-primary":"text-info",children:e.tipo===o.$P.FIXO?"Fixo":"Vari\xe1vel"})]})]}),(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between gap-3",children:[(0,s.jsx)("p",{children:e.valor?f.C.toCurrency(e.valor):"sem valor"}),(0,s.jsx)("button",{className:"btn btn-secondary",onClick:a=>l(e),children:"Editar"})]}),(0,s.jsx)("small",{children:e.comentario})]},"".concat(e.local,":").concat(a))}),t&&(0,s.jsx)(x.u,{hideFooter:!0,onClose:()=>l(null),title:"Detalhes da transa\xe7\xe3o: ".concat(null==t?void 0:t.local),children:(0,s.jsx)(h.m,{transacao:t,cleanStyle:!0,onClose:()=>l(null)})})]})}var p=t(6136);let j="label";function b(e,a){"function"==typeof e?e(a):e&&(e.current=a)}function N(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j,s=[];e.datasets=a.map(a=>{let l=e.datasets.find(e=>e[t]===a[t]);return!l||!a.data||s.includes(l)?{...a}:(s.push(l),Object.assign(l,a),l)})}let g=(0,r.forwardRef)(function(e,a){let{height:t=150,width:s=300,redraw:l=!1,datasetIdKey:n,type:o,data:c,options:i,plugins:d=[],fallbackContent:u,updateMode:m,...f}=e,x=(0,r.useRef)(null),h=(0,r.useRef)(),v=()=>{x.current&&(h.current=new p.kL(x.current,{type:o,data:function(e){var a;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j,s={labels:[],datasets:[]};return a=e.labels,s.labels=a,N(s,e.datasets,t),s}(c,n),options:i&&{...i},plugins:d}),b(a,h.current))},g=()=>{b(a,null),h.current&&(h.current.destroy(),h.current=null)};return(0,r.useEffect)(()=>{!l&&h.current&&i&&function(e,a){let t=e.options;t&&a&&Object.assign(t,a)}(h.current,i)},[l,i]),(0,r.useEffect)(()=>{if(!l&&h.current){var e,a;e=h.current.config.data,a=c.labels,e.labels=a}},[l,c.labels]),(0,r.useEffect)(()=>{!l&&h.current&&c.datasets&&N(h.current.config.data,c.datasets,n)},[l,c.datasets]),(0,r.useEffect)(()=>{h.current&&(l?(g(),setTimeout(v)):h.current.update(m))},[l,i,c.labels,c.datasets,m]),(0,r.useEffect)(()=>{h.current&&(g(),setTimeout(v))},[o]),(0,r.useEffect)(()=>(v(),()=>g()),[]),r.createElement("canvas",Object.assign({ref:x,role:"img",height:t,width:s},f),u)});function y(e,a){return p.kL.register(a),(0,r.forwardRef)((a,t)=>r.createElement(g,Object.assign({},a,{ref:t,type:e})))}let C=y("line",p.ST),S=y("doughnut",p.jI);var w=t(2840);function Y(e){let{periodo:a,transacoesAcumuladasPorMes:t}=e,l=a.reduce((e,a)=>e.plus(a.valor||0),(0,w.Z)(0));return(0,s.jsxs)("div",{className:"totals",children:[(0,s.jsx)("h5",{children:"Balan\xe7o do mes"}),(0,s.jsx)("p",{children:f.C.toCurrency(l)}),(0,s.jsx)("small",{children:f.C.extenso(l)}),(0,s.jsx)(E,{transacoesAcumuladasPorMes:t}),(0,s.jsx)(M,{periodo:a})]})}function M(e){let{periodo:a}=e,t=a.filter(e=>{var a;return e.valor&&(null===(a=e.valor)||void 0===a?void 0:a.toNumber())>=0}).reduce((e,a)=>e.plus(a.valor||0),(0,w.Z)(0)),l=a.filter(e=>{var a;return e.valor&&(null===(a=e.valor)||void 0===a?void 0:a.toNumber())<0}).reduce((e,a)=>e.plus(a.valor||0),(0,w.Z)(0));return(0,s.jsx)(S,{data:{labels:["Entradas","Saidas"],datasets:[{label:"soma em reais (R$)",data:[t,l],backgroundColor:["#65a148","#dc3545"],hoverOffset:4}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}function E(e){let{transacoesAcumuladasPorMes:a}=e;return(0,s.jsx)(C,{data:{labels:a.map(e=>e.mes),datasets:[{label:"acumulado at\xe9 o mes (R$)",data:a.map(e=>e.totalAcumulado)}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}var O=t(8792);function k(){let{isDbOk:e,repository:a}=(0,n.y$)(),[t,l]=(0,r.useState)(!0),[c,u]=(0,r.useState)(),[x,p]=(0,r.useState)({}),[j,b]=(0,r.useState)({}),[N,g]=(0,r.useState)(o.Jd.ULTIMO_MES);async function y(){l(!0),await S(),await C(),l(!1)}async function C(){var e;let t=await a.totais();console.info("loadTotals",t),u(t.valorEmCaixa),b(null===(e=t.transacoesAcumuladaPorMes)||void 0===e?void 0:e.reduce((e,a)=>(e[a.mes]=a,e),{}))}async function S(){p((await a.list(o.H$.TRANSACOES,N)).reduce((e,a)=>{let t=i()(a.data).format("YYYY-MM"),s=e[t]||[];return s.push(a),e[t]=s,e},{}))}return(0,r.useEffect)(()=>{e&&y()},[e,N]),(0,s.jsxs)("main",{className:"caixa container mt-3",children:[(0,s.jsxs)("section",{className:"d-flex justify-content-between",children:[(0,s.jsx)("h1",{children:"Caixa"}),(0,s.jsxs)("div",{className:"d-flex justify-content-between gap-3",children:[(0,s.jsx)("h5",{children:"Valor em caixa: "}),(0,s.jsxs)("p",{className:"d-flex flex-column",children:[f.C.toCurrency(c),(0,s.jsx)("small",{children:f.C.extenso(c,{mode:"currency",currency:{type:"BRL"}})})]})]})]}),(0,s.jsxs)("article",{className:"transacoes",children:[(0,s.jsxs)("section",{className:"forms",children:[(0,s.jsx)(m,{onChange:e=>g(e),value:N}),(0,s.jsx)(h.m,{})]}),(0,s.jsx)("section",{className:"periodos",children:t?(0,s.jsx)(d.a,{className:"align-self-center my-5"}):Object.keys(x).map(e=>{let a=x[e]||[],t=j[e]||{},l=i()(t.mes,"YYYY-MM"),n=l.clone().add(-5,"month"),r=Object.values(j).filter(e=>{let a=i()(e.mes,"YYYY-MM");return a.isSameOrAfter(n)&&a.isSameOrBefore(l)});return(0,s.jsxs)("section",{className:"card my-3",children:[(0,s.jsxs)("div",{className:"card-header d-flex justify-content-between align-items-center",children:[(0,s.jsxs)("h4",{className:"m-0",children:["Periodo de: ",i()(e,"YYYY-MM").format("MMMM YYYY")]}),(0,s.jsxs)("small",{children:["Valor em caixa no periodo: ",f.C.toCurrency(t.totalAcumulado)]}),(0,s.jsxs)("div",{className:"actions d-flex gap-3",children:[(0,s.jsx)(O.default,{href:"/caixa/editar-mes?month=".concat(e),className:"btn btn-dark",children:"Editar m\xeas"}),(0,s.jsx)(O.default,{href:"/caixa/copia?month=".concat(e),className:"btn btn-dark",children:"Copiar m\xeas"})]})]}),(0,s.jsxs)("div",{className:"card-body d-flex align-items-start flex-column-reverse flex-lg-row justify-content-lg-around",children:[(0,s.jsx)(v,{periodo:a}),(0,s.jsx)(Y,{periodo:a,transacoesAcumuladasPorMes:r})]})]},e)})})]})]})}function I(){return(0,s.jsx)(l.A,{children:(0,s.jsx)(k,{})})}},620:function(e,a,t){"use strict";t.d(a,{I:function(){return o}});var s=t(7437),l=t(2840),n=t(2151),r=t.n(n);function o(e){let{onChange:a,isNumber:t,groupSymbolLeft:n,groupSymbolRight:o,isPercent:c,value:i,...d}=e,u="number"===e.type||t,m="date"===e.type,f="month"===e.type,x=u?function(e,a){let{isPercent:t}=a;return null==e||isNaN(e.toNumber())?"":t?e.times(100).toNumber():e.toNumber()}(i,{isPercent:c}):m?r()(i).format("YYYY-MM-DD"):f?r()(i).format("YYYY-MM"):i||"",h=(0,s.jsx)("input",{className:"form-control",onChange:function(e){let{value:t}=e.target;(a||function(){})(c?(0,l.Z)(t).div(100):u?(0,l.Z)(t):m?r()(t,"YYYY-MM-DD").toDate():f?r()(t,"YYYY-MM").toDate():t)},value:x,...d});return n||o?(0,s.jsxs)("div",{className:"input-group mb-3",children:[n&&(0,s.jsx)("span",{className:"input-group-text",children:n}),h,o&&(0,s.jsx)("span",{className:"input-group-text",children:o})]}):h}},2021:function(e,a,t){"use strict";t.d(a,{u:function(){return n}});var s=t(7437),l=t(2265);function n(e){let{children:a,title:t,onClose:n,hideFooter:r}=e,[o,c]=(0,l.useState)(!0);function i(){c(!1),n&&n()}function d(e){var a;(null==e?void 0:null===(a=e.target)||void 0===a?void 0:a.id)==="modal"&&i()}function u(e){(null==e?void 0:e.key)==="Escape"&&i()}return(0,l.useEffect)(()=>(document.addEventListener("keydown",u,!1),()=>{document.removeEventListener("keydown",u,!1)}),[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"modal modal-lg fade ".concat(o&&"show"),id:"modal",tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",style:{zIndex:99,display:o?"block":"none"},onClick:d,children:(0,s.jsx)("div",{className:"modal-dialog",children:(0,s.jsxs)("div",{className:"modal-content",children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsx)("h5",{className:"modal-title",id:"exampleModalLabel",children:t}),(0,s.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:i})]}),(0,s.jsx)("div",{className:"modal-body",children:a}),!r&&(0,s.jsx)("div",{className:"modal-footer",children:(0,s.jsx)("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",onClick:i,children:"Close"})})]})})}),(0,s.jsx)("div",{className:"modal-backdrop fade ".concat(o&&"show"),style:{zIndex:98},onClick:d})]})}},6274:function(e,a,t){"use strict";t.d(a,{C:function(){return o}});var s=t(2840),l=t(6947),n=t.n(l);let r=new Intl.NumberFormat("pt-br",{style:"currency",currency:"BRL"});class o{static extenso(e,a){var t;return(e instanceof s.Z&&(e=null==e?void 0:null===(t=e.integerValue())||void 0===t?void 0:t.toNumber()),null==e||isNaN(e)||!isFinite(e))?"":n()(e,a)}static toCurrency(e,a){return("string"==typeof e&&(e=Number(e)),e instanceof s.Z&&(e=null==e?void 0:e.toNumber()),null==e||isNaN(e)||!isFinite(e))?"":r.format(e)}}},6178:function(){}},function(e){e.O(0,[674,218,990,935,964,947,156,971,69,744],function(){return e(e.s=4711)}),_N_E=e.O()}]);